@model List<GetBrandsWithModelsViewModel>

@{
    ViewData["Title"] = "Marka ve Modeller";
    Layout = "~/Areas/Admin/Views/AdminUILayout/Index.cshtml";
    int count = 0;
}

<style>
    .brand-row {
        cursor: pointer;
        transition: background-color 0.2s;
    }

    .brand-row:hover {
        background-color: #e9ecef;
    }
</style>

<div class="page-content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-xl-12">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h4 class="card-title mb-3">Marka ve Modeller</h4>
                        <p class="card-subtitle mb-4">
                            Marka ve modeller ile ilgili işlemleri buradan gerçekleştirebilirsiniz.
                        </p>

                        <div class="table-responsive">
                            <table class="table table-bordered align-middle">
                                <thead class="table-light">
                                    <tr>
                                        <th style="width:50px;">#</th>
                                        <th>Marka Adı</th>
                                        <th style="width:120px;">Model Ekle</th>
                                        <th style="width:120px;">Güncelle</th>
                                        <th style="width:120px;">Sil</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var brandItem in Model)
                                    {
                                        count++;
                                        string collapseId = $"collapseBrand_{brandItem.Brand.BrandId}";

                                        <tr class="brand-row" data-target="#@collapseId">
                                            <td>@count</td>
                                            <td>
                                                <i class="bi bi-chevron-down me-2"></i>@brandItem.Brand.Name
                                            </td>
                                            <td>
                                                <a href="/Admin/Model/CreateModelModal/@brandItem.Brand.BrandId" class="btn btn-outline-primary btn-sm">Model Ekle</a>
                                            </td>
                                            <td>
                                                <a href="/Admin/Brand/UpdateBrandModal/@brandItem.Brand.BrandId" class="btn btn-outline-warning btn-sm">Güncelle</a>
                                            </td>
                                            <td>
                                                <a href="/Admin/Brand/Delete/@brandItem.Brand.BrandId" class="btn btn-outline-danger btn-sm">Sil</a>
                                            </td>
                                        </tr>

                                        <tr>
                                            <td colspan="5" class="p-0 border-0">
                                                <div class="collapse" id="@collapseId">
                                                    <div class="p-3">
                                                        @if (brandItem.Models != null && brandItem.Models.Any())
                                                        {
                                                            <table class="table table-sm table-hover mb-0">
                                                                <thead class="table-secondary">
                                                                    <tr>
                                                                        <th style="width:50px;">#</th>
                                                                        <th>Model Adı</th>
                                                                        <th>Sınıf</th>
                                                                        <th style="width:120px;">Detaylar</th>
                                                                        <th style="width:120px;">Güncelle</th>
                                                                        <th style="width:120px;">Sil</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    @{
                                                                        int modelCount = 0;
                                                                        foreach (var modelItem in brandItem.Models)
                                                                        {
                                                                            modelCount++;
                                                                            <tr>
                                                                                <td>@modelCount</td>
                                                                                <td>@modelItem.ModelName</td>
                                                                                <td>@modelItem.CarClass?.ClassName</td>
                                                                                <td>
                                                                                    <a href="/Admin/Model/ModelDetail/@modelItem.ModelId" class="btn btn-outline-info btn-sm">Detaylar</a>
                                                                                </td>
                                                                                <td>
                                                                                    <a href="/Admin/Model/UpdateModelModal/@modelItem.ModelId" class="btn btn-outline-warning btn-sm">Güncelle</a>
                                                                                </td>
                                                                                <td>
                                                                                    <a href="/Admin/Model/Delete/@modelItem.ModelId" class="btn btn-outline-danger btn-sm">Sil</a>
                                                                                </td>
                                                                            </tr>
                                                                        }
                                                                    }
                                                                </tbody>
                                                            </table>
                                                        }
                                                        else
                                                        {
                                                            <p class="text-muted m-0">Bu markaya ait model bulunmamaktadır.</p>
                                                        }
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>

                        <a href="/Admin/Brand/CreateBrandModal" class="btn btn-outline-primary mt-3">
                            Marka Ekle
                        </a>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $(".brand-row").on("click", function (e) {
            if (!$(e.target).closest("a, button").length) {
                const targetId = $(this).data("target");
                const collapseElement = $(targetId);

                collapseElement.collapse('toggle');

                const icon = $(this).find("i.bi");
                icon.toggleClass("bi-chevron-down bi-chevron-up");
            }
        });
    });
</script>